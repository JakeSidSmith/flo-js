<!DOCTYPE html>
<html>
<head>
    <title>Flo-js</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
    <link rel="stylesheet" href="css/master.css" media="screen" title="no title" charset="utf-8" />
    <script charset="utf-8" type="text/javascript" src="flo.js"></script>
    <script charset="utf-8" type="text/javascript">
        var canvasElement, canvas, cWidth, cHeight, person, speed, additionalPositions, additionalAnimations;

        speed = 0.3;

        var drawUpperBody = function () {
          canvas.rotate(person.position.bodyRotation * Math.PI / 180);
          canvas.beginPath();
          canvas.moveTo(0, 0);
          canvas.lineTo(0, -65);
          canvas.moveTo(0, 0);
          canvas.closePath();
          canvas.stroke();
          canvas.translate(0, -65);
          drawHead();
          drawRightArm();
          drawLeftArm();
        };

        var drawHead = function () {
          canvas.save();
          canvas.rotate(person.position.headRotation * Math.PI / 180);
          canvas.beginPath();
          canvas.arc(0,-17,15,0,2*Math.PI);
          canvas.closePath();
          canvas.stroke();
          canvas.restore();
        };

        var drawRightArm = function () {
          canvas.save();
          canvas.rotate(person.position.upperRightArmRotation * Math.PI / 180);
          canvas.beginPath();
          canvas.moveTo(0, 0);
          canvas.lineTo(0, 40);
          canvas.moveTo(0, 0);
          canvas.closePath();
          canvas.stroke();
          canvas.translate(0, 40);
          // Lower right
          canvas.rotate(person.position.lowerRightArmRotation * Math.PI / 180);
          canvas.beginPath();
          canvas.moveTo(0, 0);
          canvas.lineTo(0, 40);
          canvas.moveTo(0, 0);
          canvas.closePath();
          canvas.stroke();
          canvas.restore();
        };

        var drawLeftArm = function () {
          canvas.save();
          canvas.rotate(person.position.upperLeftArmRotation * Math.PI / 180);
          canvas.beginPath();
          canvas.moveTo(0, 0);
          canvas.lineTo(0, 40);
          canvas.moveTo(0, 0);
          canvas.closePath();
          canvas.stroke();
          canvas.translate(0, 40);
          // Lower right
          canvas.rotate(person.position.lowerLeftArmRotation * Math.PI / 180);
          canvas.beginPath();
          canvas.moveTo(0, 0);
          canvas.lineTo(0, 40);
          canvas.moveTo(0, 0);
          canvas.closePath();
          canvas.stroke();
          canvas.restore();
        };

        var drawRightLeg = function () {
          // Right leg
          canvas.save();
          canvas.rotate(person.position.upperRightLegRotation * Math.PI / 180);
          canvas.beginPath();
          canvas.moveTo(0, 0);
          canvas.lineTo(0, 50);
          canvas.moveTo(0, 0);
          canvas.closePath();
          canvas.stroke();
          // Lower right
          canvas.translate(0, 50);
          canvas.rotate(person.position.lowerRightLegRotation * Math.PI / 180);
          canvas.beginPath();
          canvas.moveTo(0, 0);
          canvas.lineTo(0, 50);
          canvas.moveTo(0, 0);
          canvas.closePath();
          canvas.stroke();
          canvas.restore();
        };

        var drawLeftLeg = function () {
          // Left leg
          canvas.save();
          canvas.rotate(person.position.upperLeftLegRotation * Math.PI / 180);
          canvas.beginPath();
          canvas.moveTo(0, 0);
          canvas.lineTo(0, 50);
          canvas.moveTo(0, 0);
          canvas.closePath();
          canvas.stroke();
          // Lower left
          canvas.translate(0, 50);
          canvas.rotate(person.position.lowerLeftLegRotation * Math.PI / 180);
          canvas.beginPath();
          canvas.moveTo(0, 0);
          canvas.lineTo(0, 50);
          canvas.moveTo(0, 0);
          canvas.closePath();
          canvas.stroke();
          canvas.restore();
        };

        var render = function () {
          canvas.clearRect(0, 0, cWidth, cHeight);
          canvas.strokeStyle = 'black';
          canvas.lineWidth = 4;
          canvas.lineCap = 'round';

          // Draw upper body
          canvas.save();
          canvas.translate(cWidth / 2, cHeight - 100);
          drawUpperBody();
          canvas.restore();
          // Draw legs
          canvas.save();
          canvas.translate(cWidth / 2, cHeight - 100);
          drawRightLeg();
          drawLeftLeg();
          canvas.restore();

          person.flo.animate();
          additionalAnimations.animate();

          canvas.fillStyle = 'black';
          canvas.rect(additionalPositions.x - 5, additionalPositions.y - 10, 10, 10);
          canvas.fill();

          if (person.flo.currentAnimation === undefined) {
            person.flo.do('rightLegUp');
          }

          flo().requestAnimationFrame(render);
        };

        var init = function () {
          canvasElement = document.getElementById('canvas');
          canvas = canvasElement.getContext('2d');
          cWidth = canvasElement.width;
          cHeight = canvasElement.height;

          person = {
            position: {
              bodyRotation: 0,
              headRotation: 0,
              upperRightArmRotation: 0,
              lowerRightArmRotation: 0,
              upperLeftArmRotation: 0,
              lowerLeftArmRotation: 0,
              upperRightLegRotation: 0,
              lowerRightLegRotation: 0,
              upperLeftLegRotation: 0,
              lowerLeftLegRotation: 0,
            }
          };

          person.flo = flo(person.position);

          additionalPositions = {
            x: 120,
            y: 240
          };

          additionalAnimations = flo(additionalPositions);

          additionalAnimations.animation('moveDown')
            .duration(1000)
            .nextPosition({y: 480})
            .ease('in')
            .onComplete('moveUp')
            .do();

          additionalAnimations.animation('moveUp')
            .duration(1000)
            .nextPosition({y: 240})
            .ease('out')
            .onComplete('moveDown');

          person.flo.animation('rightLegUp')
            .duration(700 * speed)
            .nextPosition(
              {
                bodyRotation: 5,
                headRotation: 10,
                upperRightArmRotation: 70,
                lowerRightArmRotation: -100,
                upperLeftArmRotation: -45,
                lowerLeftArmRotation: -100,
                upperRightLegRotation: -40,
                lowerRightLegRotation: 50,
                upperLeftLegRotation: 20,
                lowerLeftLegRotation: 25,
              }
            )
            .onComplete('rightLegForward');

          person.flo.animation('rightLegForward')
            .duration(500 * speed)
            .nextPosition(
              {
                bodyRotation: 10,
                headRotation: 20,
                upperRightArmRotation: 45,
                lowerRightArmRotation: -70,
                upperLeftArmRotation: -30,
                lowerLeftArmRotation: -45,
                upperRightLegRotation: -10,
                lowerRightLegRotation: 0,
                upperLeftLegRotation: 30,
                lowerLeftLegRotation: 55,
              }
            )
            .onComplete('leftLegUp');

          person.flo.animation('leftLegUp')
            .duration(700 * speed)
            .nextPosition(
              {
                bodyRotation: 5,
                headRotation: 10,
                upperRightArmRotation: -45,
                lowerRightArmRotation: -100,
                upperLeftArmRotation: 70,
                lowerLeftArmRotation: -100,
                upperRightLegRotation: 20,
                lowerRightLegRotation: 25,
                upperLeftLegRotation: -40,
                lowerLeftLegRotation: 50,
              }
            )
            .onComplete('leftLegForward');

          var steps = 0;

          person.flo.animation('leftLegForward')
            .duration(500 * speed)
            .nextPosition(
              {
                bodyRotation: 10,
                headRotation: 20,
                upperRightArmRotation: -30,
                lowerRightArmRotation: -45,
                upperLeftArmRotation: 45,
                lowerLeftArmRotation: -70,
                upperRightLegRotation: 30,
                lowerRightLegRotation: 55,
                upperLeftLegRotation: -10,
                lowerLeftLegRotation: 0,
              }
            )
            .onComplete(function () {
              steps += 1;
              if (steps % 5 === 0) {
                person.flo.animation('rightLegUp').invert();
                person.flo.animation('rightLegForward').invert();
                person.flo.animation('leftLegUp').invert();
                person.flo.animation('leftLegForward').invert();
              }
              person.flo.do('rightLegUp');
            });

          flo().requestAnimationFrame(render);
        };

        var enterFullscreen = function () {
          flo().enterFullscreen(document.getElementById('canvas'));
        };

        flo().onDocumentReady(init);
    </script>
</head>
<body>

    <div class="container">
        <h1>Flo-js</h1>

        <p>Animation library for use with HTML5 canvas</p>

        <canvas id="canvas" width="640" height="480">
            <p>
                Sorry, it looks like your browser doesn't support the canvas element.
            </p>
        </canvas>

        <p>
            <button name="button" onclick="enterFullscreen()">Fullscreen</button>
        </p>
    </div>

</body>
</html>
